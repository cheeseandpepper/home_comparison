<p id="notice"><%= notice %></p>
<%= link_to "Back", houses_path %>
<h1>Features</h1>

<div class='well'>
  <div class='row'>
    <div class='col-xs-4'>
      <div class='house-images-container'>
        <% @house.house_images.each_with_index do |h, i| %>
          <div><%= image_tag h.url, id: "image-index-#{i}"%></div>
        <% end %>
      </div>
    </div>

    <div class='col-xs-8'>
      <div class='score-list'>
        <div class='row'>
          <div class='col-xs-8'><h1>Score: </h1></div>
          <div class='col-xs-4'><h1><span id='house-score'> <%= @house.overall_score %></span></h1></div>
        </div>
    </div>

  </div>
</div>

<table class='table'>
  <thead>
    <tr>
      <th>Name</th>
      <th>Score</th>
      <th>Weight</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @features.each do |feature| %>
      <tr data-feature-id="<%= feature.id %>" data-house-id="<%= @house.id %>">
        <%= render partial: '/features/feature_row', locals: { feature: feature } %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>



<script>
//$('#image-index-0').attr('style', "display: visible")

$(document).ready(function(){
  $('.house-images-container').slick();
});


$('.house-images-container').on('mouseover', 'img', function() {
  
})

$('tr input').on('change', function(event) {
  var target    = event.target;
  var column    = target.id.split('-')[1];
  var value     = target.value;
  var featureId = $(target).closest('tr').data('feature-id')
  var houseId   = $(target).closest('tr').data('house-id')
  
  var data = {};
  data[column] = value;
  var url = '/houses/' + houseId + '/features/' + featureId;

  $.ajax({
    type: 'PUT',
    url: url,
    dataType: 'json',
    data: { feature: data },
    success: function(data) {
      var score = data.overall_score;
      //var maxScore = data.max_score;
      //var overallScore = data.overall_score;

      $('.score-list').find('#house-score').text(score) 
    }
  })
})

</script>